<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BD NETWORK SOLUTIONS - Data Order</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Paystack Checkout SDK -->
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <style>
        /* Import Inter font from Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        /* Base body styles */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            color: #1a202c; /* Deeper dark gray for body text - nearly black for strong contrast */
            background-color: #f8fafc; /* Lighter off-white background for softness */
            line-height: 1.6; /* Improved readability for body text */
        }

        /* Main navigation bar styling */
        .main-navbar {
            background-color: #FFD700; /* MTN Yellow */
            color: #1a202c; /* Dark text for contrast */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); /* More pronounced, yet soft shadow */
            position: relative; /* Needed for absolute positioning of mobile menu */
            z-index: 40; /* Ensure navbar is above other content */
            padding-top: 1rem; /* Slightly more padding */
            padding-bottom: 1rem; /* Slightly more padding */
        }

        /* Logo text styling */
        .main-navbar .logo-text {
            color: #1a202c; /* Dark text for brand name on yellow background */
            font-size: 1.45rem; /* Slightly larger for prominence */
            font-weight: 800; /* Extra bold */
            white-space: nowrap; /* Prevent wrapping */
        }

        /* Slogan text styling - Adjusted margin and color */
        .main-navbar .slogan-text {
            color: #4a5568; /* Subtle gray for contrast with main logo text */
            font-size: 0.7rem; /* Slightly larger */
            font-weight: 500; /* Medium weight */
            margin-top: 0.1rem; /* Adjusted to visually separate slightly */
            white-space: nowrap; /* Prevent wrapping */
        }

        /* Hero section styling */
        .hero-section {
            background-image: url('https://i.imgur.com/7bSulGO.jpeg'); /* Background image */
            background-size: cover; /* Cover the entire area */
            background-position: center; /* Center the background image */
            min-height: 90vh; /* Slightly reduced for better flow on smaller screens */
            display: flex;
            align-items: center; /* Center content vertically */
            position: relative; /* Needed for overlay */
            padding: 4rem 0; /* Consistent vertical padding */
        }

        /* Hero overlay for text readability */
        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6); /* Slightly darker overlay for better text contrast */
            z-index: 1;
        }

        /* Wrapper for hero content */
        .hero-content-wrapper {
            position: relative;
            z-index: 2;
            color: #ffffff; /* White text for hero content */
            display: flex;
            flex-direction: column; /* Stack vertically on small screens */
            align-items: center; /* Center items on small screens */
            justify-content: center; /* Distribute space */
            width: 100%;
            padding: 0 1.5rem; /* Default horizontal padding for mobile */
        }

        /* Media query for medium screens and up to arrange hero content side-by-side */
        @media (min-width: 768px) {
            .hero-content-wrapper {
                flex-direction: row;
                align-items: center; /* Align to the center of the flex container */
                justify-content: space-around; /* Adjust spacing */
                padding: 0 4rem; /* More generous horizontal padding on desktop */
            }
        }

        /* Hero text content styling */
        .hero-text-content {
            text-align: center; /* Center text on small screens */
            margin-bottom: 3rem; /* More space between text and card on small screens */
            width: 100%; /* Full width on small screens */
            max-width: 550px; /* Constrain width for readability */
        }

        /* Media query for medium screens and up for hero text alignment */
        @media (min-width: 768px) {
            .hero-text-content {
                text-align: left; /* Align text to left on larger screens */
                width: 45%; /* Take up roughly half the width */
                margin-bottom: 0;
            }
        }

        /* Adjusted H1 font size for hero section */
        .hero-text-content h1 {
            font-size: 2.25rem; /* Larger for better impact on mobile */
            font-weight: 800; /* Extra bold */
            line-height: 1.25; /* Slightly increased line height */
            margin-bottom: 1rem;
            margin-left: auto; /* Center on small screens */
            margin-right: auto; /* Center on small screens */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3); /* Subtle text shadow for depth */
        }

        /* Media query for larger screens for H1 font size */
        @media (min-width: 768px) {
            .hero-text-content h1 {
                font-size: 3.75rem; /* Larger for desktop impact */
                margin-left: 0;
                margin-right: 0;
            }
        }
        .hero-text-content p {
            font-size: 1.15rem; /* Slightly larger body text in hero */
            opacity: 0.9; /* Slightly transparent for depth */
        }

        /* Blended Card Styling (for auth section) */
        .card {
            background-color: rgba(255, 255, 255, 0.95); /* Nearly opaque white for professionalism */
            backdrop-filter: blur(8px); /* Increased blur effect */
            -webkit-backdrop-filter: blur(8px); /* Safari support */
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3); /* Stronger, softer shadow */
            border-radius: 16px; /* More rounded corners */
            padding: 3rem; /* More generous padding inside the card */
            color: #1a202c; /* Dark text for better contrast */
            border: 1px solid rgba(255, 255, 255, 0.8); /* More visible white border */
            width: 100%;
            max-width: 480px; /* Slightly wider max-width for balance */
        }

        /* Input field styling */
        .input-field {
            background-color: #ffffff; /* Solid white background */
            border: 1px solid #d1d5db; /* A slightly darker gray for borders */
            color: #1a202c; /* Dark text */
            padding: 0.85rem 1.15rem; /* Increased padding */
            border-radius: 0.65rem; /* More rounded corners */
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .input-field:focus {
            border-color: #FFC000; /* Richer yellow border on focus */
            box-shadow: 0 0 0 4px rgba(255, 192, 0, 0.3); /* Softer, wider yellow glow on focus */
            outline: none; /* Remove default outline */
        }
        /* Message box styling */
        .message-box {
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            margin-top: 1rem;
            font-weight: 500;
            opacity: 0.95; /* Slightly less opaque */
        }
        .message-box.info {
            background-color: #e0f7fa; /* Lighter cyan */
            color: #00796b; /* Darker cyan */
            border: 1px solid #80deea;
        }
        .message-box.success {
            background-color: #e8f5e9; /* Lighter green */
            color: #2e7d32; /* Darker green */
            border: 1px solid #a5d6a7;
        }
        .message-box.error {
            background-color: #ffebee; /* Lighter red */
            color: #c62828; /* Darker red */
            border-color: #ef9a9a;
        }

        /* User info bar styling (dashboard) */
        .user-info-bar {
            background-color: #263238; /* Dark slate gray */
            color: #FFD700; /* MTN Yellow for text */
            padding: 1rem 2rem; /* More generous padding */
            border-radius: 10px; /* Slightly more rounded corners */
            display: flex; /* Use flexbox for alignment */
            flex-direction: row; /* Arrange items horizontally */
            align-items: center; /* Vertically center items */
            justify-content: space-between; /* Space between user display and button */
            font-weight: 600;
            margin-bottom: 2.5rem; /* More space below the user info bar */
            width: 100%; /* Ensure it spans the full width of its parent */
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); /* Subtle shadow */
        }

        #user-display {
            font-size: 1.2rem; /* Larger font for welcome message */
            font-weight: 700; /* Bold */
            color: #FFD700; /* Yellow text for welcome message */
            white-space: nowrap; /* Prevent wrapping for the name */
            overflow: hidden; /* Hide overflow if name is too long */
            text-overflow: ellipsis; /* Add ellipsis for long names */
            margin-right: 1.5rem; /* More space between text and button */
        }

        .user-info-bar button {
            background-color: #FFD700; /* MTN Yellow for sign out button */
            color: #1a202c; /* Dark text for contrast on yellow */
            padding: 0.75rem 1.5rem; /* Padding for the button */
            border-radius: 8px; /* More rounded */
            font-weight: 700; /* Bolder */
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            border: none; /* Remove default button border */
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Subtle button shadow */
        }
        .user-info-bar button:hover {
            background-color: #FFC000; /* Slightly darker yellow on hover */
            color: #000000; /* Black text on hover for more contrast */
            transform: translateY(-1px); /* Slight lift effect */
            box-shadow: 0 4px 8px rgba(0,0,0,0.15); /* Enhanced shadow on hover */
        }

        /* Adjust for small screens if needed */
        @media (max-width: 640px) {
            .user-info-bar {
                flex-direction: column; /* Stack items vertically on small screens */
                align-items: flex-start; /* Align text to the left */
                padding: 1rem;
            }
            #user-display {
                margin-right: 0;
                margin-bottom: 0.75rem; /* More space between name and button */
                text-align: left;
                width: 100%;
            }
            .user-info-bar button {
                width: 100%; /* Full width button on mobile */
                align-self: center; /* Center button */
            }
        }

        /* Adjust specific text/elements inside the card */
        #auth-title, #main-app-section h2, #order-details-step h3 {
            color: #1a202c; /* Headings to dark, consistent */
            text-shadow: none;
            font-weight: 800; /* Ensure headings are extra bold */
        }
        #auth-subtitle, .text-gray-600 {
            color: #64748b; /* A slightly darker gray for better readability */
        }

        /* Payment account details styling */
        .payment-account {
            background-color: #f0f4f8; /* Light blue-gray background */
            border: 1px solid #e2e8f0;
            color: #1a202c; /* Dark text */
            padding: 1.25rem; /* More padding */
            border-radius: 0.75rem; /* More rounded corners */
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); /* Slightly more visible shadow */
            transition: transform 0.2s ease-in-out;
        }
        .payment-account:hover {
            transform: translateY(-2px); /* Subtle lift on hover */
        }
        .payment-account strong, .payment-account p {
            color: #1a202c; /* Dark text */
        }
        .payment-account img {
            height: auto;
            max-width: 60px; /* Reduced logo size in payment accounts */
            margin-right: 0.75rem;
            vertical-align: middle;
            background-color: transparent;
            padding: 0;
            border-radius: 0;
        }

        /* Agent Message Display styling (for floating box) */
        #agent-message-container {
            background-color: #fffde7; /* Very light yellow */
            color: #8d6e63; /* Soft brown */
            padding: 1rem 1.5rem; /* More padding */
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 500;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out, transform 0.2s ease-in-out;
            max-width: 380px; /* Slightly wider */
            text-align: center;
            border: 1px solid #ffcc80; /* Soft orange border */
            position: absolute; /* Position absolutely */
            top: 5.5rem; /* Below the nav bar with more clearance */
            right: 1.5rem; /* Align with right edge */
            z-index: 30;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        #agent-message-container.show {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
            transform: translateY(0);
        }
        #agent-message-container a {
            color: #007bff; /* Standard blue for links */
            font-weight: 700;
            text-decoration: underline;
        }
        #agent-message-container a:hover {
            color: #0056b3;
        }


        /* Styles for the new dashboard navigation buttons */
        .dashboard-nav-buttons button {
            background-color: #FFD700;
            color: #1a202c; /* Dark text */
            padding: 0.9rem 1.8rem; /* More generous padding */
            border-radius: 10px; /* More rounded */
            font-weight: 700;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex; /* Make buttons flexible for icons */
            align-items: center;
            gap: 0.75rem; /* More space between icon and text */
            font-size: 1.05rem; /* Slightly larger font */
            min-width: 160px; /* Ensure a minimum width for consistency */
            justify-content: center; /* Center content within buttons */
        }
        .dashboard-nav-buttons button:hover {
            background-color: #FFC000;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }
        .dashboard-nav-buttons button.active {
            background-color: #1a202c; /* Dark background for active button */
            color: #FFD700; /* Yellow text for active button */
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3), 0 2px 4px rgba(0, 0, 0, 0.1); /* Inset shadow for pressed look, plus subtle outer shadow */
            transform: translateY(0); /* Remove lift for active state */
        }
        /* Flex wrap behavior for mobile buttons */
        @media (max-width: 767px) {
            .dashboard-nav-buttons {
                flex-direction: row; /* Keep buttons in a row */
                flex-wrap: wrap; /* Allow buttons to wrap to the next line */
                justify-content: center; /* Center buttons when they wrap */
                gap: 0.75rem; /* Spacing between stacked buttons */
            }
            .dashboard-nav-buttons button {
                width: auto; /* Allow buttons to take natural width */
                flex-grow: 1; /* Allow buttons to grow and fill space */
                max-width: calc(50% - 0.75rem); /* Max width for two buttons per row, with gap */
            }
        }


        /* Styling for individual order items */
        #orders-list > div {
            background-color: #ffffff; /* White background for list items */
            border: 1px solid #e5e7eb;
            border-radius: 10px; /* More rounded */
            padding: 1.25rem; /* More padding */
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); /* Subtle shadow */
        }
        #orders-list > div p {
            color: #2d3748; /* Slightly darker text for order details */
            line-height: 1.5;
        }
        #orders-list > div strong {
            color: #1a202c; /* Stronger dark for labels */
        }
        .mark-delivered-btn {
            background-color: #28a745; /* Bootstrap green */
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            margin-top: 1rem; /* More space from other text */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .mark-delivered-btn:hover {
            background-color: #218838; /* Darker green */
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }


        /* Hamburger menu button styling */
        #mobile-menu-button {
            display: block; /* Always show hamburger button */
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            z-index: 60; /* Ensure it's above the mobile menu */
        }
        #mobile-menu-button svg {
            width: 32px; /* Slightly larger icon */
            height: 32px; /* Slightly larger icon */
            fill: #1a202c; /* Dark color for icon */
            stroke: #1a202c; /* Ensure stroke is also dark for visibility */
            transition: transform 0.2s ease-in-out;
        }
        #mobile-menu-button:hover svg {
            transform: scale(1.1); /* Subtle hover effect */
        }

        /* Mobile menu styling (hidden by default, slides in) */
        #mobile-menu {
            position: absolute; /* Changed from fixed to absolute */
            top: 100%; /* Position below the navbar */
            right: 1.5rem; /* Align to the right of the navbar */
            width: 220px; /* Wider for better touch targets */
            height: auto; /* Adjust height based on content */
            background-color: #ffffff; /* White background */
            color: #1a202c; /* Dark text */
            border: 1px solid #e2e8f0; /* Light border */
            border-radius: 10px; /* More rounded */
            box-shadow: 0 6px 16px rgba(0,0,0,0.15); /* Stronger shadow */
            opacity: 0; /* Start invisible */
            visibility: hidden; /* Hide completely */
            transform: translateY(10px); /* Start slightly below */
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out, transform 0.3s ease-in-out; /* Fade and slide transition */
            z-index: 50; /* Ensure it's above other content */
            padding: 0.75rem 0; /* More padding */
            display: flex; /* Use flex for internal layout */
            flex-direction: column;
            align-items: stretch; /* Stretch links to full width */
            justify-content: flex-start;
        }
        #mobile-menu.open {
            opacity: 1; /* Fade in */
            visibility: visible; /* Make visible */
            transform: translateY(0); /* Slide to position */
        }
        #mobile-menu a {
            color: #1a202c; /* Dark text for menu items */
            padding: 0.85rem 1.25rem; /* More padding */
            width: 100%;
            text-align: left; /* Left align for menu items */
            font-size: 1.05rem; /* Slightly larger font */
            font-weight: 500; /* Medium weight */
            transition: background-color 0.2s, color 0.2s;
            border-radius: 6px; /* Subtle rounding for hover effect */
        }
        #mobile-menu a:hover {
            background-color: #f0f2f5; /* Light gray on hover */
            color: #000000; /* Darker text on hover */
        }

        /* Hide desktop nav links on all screens */
        .main-navbar .desktop-nav-links {
            display: none;
        }

        /* New styles for full-screen dashboard */
        #main-app-section {
            min-height: calc(100vh - 4rem); /* Adjust based on navbar height */
            width: 100%;
            padding-top: 2rem; /* More vertical padding */
            padding-bottom: 4rem; /* More vertical padding */
            background-color: #f8fafc; /* Match body background */
            display: flex;
            flex-direction: column;
            align-items: center; /* Center content horizontally */
        }
        #main-app-section > .container {
            width: 100%;
            max-width: 1200px; /* Max width for overall dashboard content */
            padding: 0 1.5rem; /* Increased default horizontal padding for mobile */
        }
        @media (min-width: 768px) {
            #main-app-section > .container {
                padding: 0 2rem; /* More generous horizontal padding on desktop */
            }
        }
        .dashboard-content-wrapper {
            width: 100%;
        }

        /* Dashboard Content Area (the white card that contains the order page) */
        #dashboard-content-area {
            background-color: #ffffff; /* White background for the main dashboard area */
            border-radius: 16px; /* More rounded corners */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1); /* Softer, more diffuse shadow */
            padding: 2rem; /* Increased padding inside this container */
            width: 100%; /* Takes full width of its parent container */
            max-width: 950px; /* Slightly wider maximum width for the dashboard content */
            color: #1a202c; /* Dark text for content inside the white card */
            margin-left: auto; /* Center the dashboard content area */
            margin-right: auto; /* Center the dashboard content area */
            margin-top: 2rem; /* More space below the user info bar */
        }

        /* Order sections within dashboard (this is the order page itself) */
        #order-placement-section,
        #my-orders-section,
        #account-settings-section {
            background-color: #fefefe; /* Even lighter background for inner sections */
            border: 1px solid #e2e8f0;
            border-radius: 12px; /* Consistent rounding */
            padding: 2rem; /* Increased padding inside the order section */
            margin-top: 2rem; /* More space between the tab buttons and the order section / previous section */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); /* Subtle inset shadow */
        }

        /* Styling for the individual stat cards in My Orders section */
        .stat-card {
            background-color: #ffffff;
            padding: 1.75rem; /* More padding */
            border-radius: 12px; /* Consistent rounding */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08); /* More prominent shadow */
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.2s ease-in-out;
        }
        .stat-card:hover {
            transform: translateY(-3px); /* Noticeable lift on hover */
        }
        .stat-card p {
            margin: 0;
            line-height: 1.3;
        }
        .stat-card .stat-value {
            font-size: 2.25rem; /* Larger value font size */
            font-weight: 800; /* Extra bold */
            color: #1a202c; /* Darker for impact */
        }
        .stat-card .stat-label {
            font-size: 0.95rem; /* Slightly larger label font size */
            color: #718096; /* Medium gray */
        }
        .stat-card i {
            font-size: 3rem; /* Larger icon */
            opacity: 0.8; /* Slightly less opaque */
        }

        /* Updated submit button for login page to match image */
        .submit-button {
            background-color: #000000; /* Black */
            color: #ffffff; /* White */
            padding: 0.9rem 1.8rem; /* More generous padding */
            border-radius: 0.75rem; /* More rounded */
            font-weight: 700; /* Bold */
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2); /* Enhanced shadow */
            border: none; /* Ensure no border */
            cursor: pointer;
            font-size: 1.05rem; /* Slightly larger font */
        }
        .submit-button:hover {
            background-color: #1a1a1a; /* Slightly lighter black on hover */
            transform: translateY(-2px); /* More pronounced lift */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3); /* Stronger shadow on hover */
        }
        .submit-button:active {
            transform: translateY(0); /* Press down effect */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Reduced shadow on active */
        }

        /* Status colors for customer dashboard */
        .status-submitted { color: #f59e0b; font-weight: 600; } /* Amber, previously for pending, now for submitted */
        .status-processing { color: #3b82f6; font-weight: 600; } /* Blue */
        .status-delivered { color: #10b981; font-weight: 600; } /* Green */
        .status-cancelled { color: #ef4444; font-weight: 600; } /* Red */
        .status-unknown { color: #6b7280; font-weight: 600; } /* Gray */

        /* Mobile-specific font size adjustments for auth-title */
        #auth-title {
            font-size: 2.5rem; /* Larger text-3xl for mobile */
            margin-bottom: 1.5rem; /* More space below title */
        }
        @media (min-width: 768px) {
            #auth-title {
                font-size: 3.5rem; /* Larger text-4xl for desktop */
            }
        }
        #auth-subtitle {
            font-size: 1rem; /* Base text size */
            margin-top: 1.5rem; /* More space above subtitle */
        }
        .auth-toggle-link {
            font-weight: 600; /* Make toggle links bolder */
        }

        /* Style for password input container to position the toggle button */
        .password-input-container {
            position: relative;
            width: 100%;
        }

        /* Style for the password toggle button */
        .password-toggle {
            position: absolute;
            right: 12px; /* Adjusted position */
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #6b7280; /* gray-500 */
            font-size: 1.1rem; /* Slightly larger icon */
            padding: 0.3rem; /* More padding for easier tap */
            border-radius: 0.35rem; /* Slight rounding */
            transition: color 0.2s ease-in-out, background-color 0.2s;
        }

        .password-toggle:hover {
            color: #1a202c; /* Darker gray on hover */
            background-color: rgba(0,0,0,0.05); /* Subtle background on hover */
        }

        /* Styles for individual order item in the form */
        .single-order-item {
            border: 1px solid #e2e8f0; /* Light gray border */
            border-radius: 0.75rem; /* More rounded */
            padding: 1.5rem; /* More padding */
            margin-bottom: 1.25rem; /* More space between multiple order items */
            background-color: #fdfdfd; /* Very light background for items */
            position: relative; /* For positioning remove button */
            box-shadow: 0 1px 6px rgba(0,0,0,0.05); /* Subtle shadow */
        }

        .remove-order-item-btn {
            position: absolute;
            top: 0.6rem; /* Adjusted position */
            right: 0.6rem; /* Adjusted position */
            background-color: #dc3545; /* Bootstrap red */
            color: white;
            border: none;
            border-radius: 50%; /* Circular button */
            width: 30px; /* Larger touch target */
            height: 30px; /* Larger touch target */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem; /* Larger 'X' */
            font-weight: 700; /* Bolder 'X' */
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .remove-order-item-btn:hover {
            background-color: #c82333; /* Darker red */
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        /* Outer FAQ Details Container */
        #faq-container-wrapper {
            width: 100%;
            max-width: 900px;
            margin: 3.5rem auto; /* Consistent vertical margin */
            padding: 0 1.5rem; /* Horizontal padding */
        }

        #faq-container-wrapper details {
            background-color: #ffffff; /* White background for the outer container */
            border: 1px solid #e2e8f0;
            border-radius: 16px; /* More rounded corners */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1); /* Consistent shadow with other main cards */
            color: #1a202c;
            overflow: hidden; /* Ensures border-radius applies to all content */
        }

        #faq-container-wrapper summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2.5rem; /* More generous padding for the main FAQ header */
            font-weight: 800; /* Extra bold for main header */
            cursor: pointer;
            list-style: none;
            background-color: #FFD700; /* MTN Yellow background for the main FAQ header */
            color: #1a202c; /* Dark text on yellow */
            font-size: 1.75rem; /* Larger font size for the main header */
            transition: background-color 0.2s ease-in-out, box-shadow 0.2s;
            border-bottom: 1px solid rgba(0,0,0,0.1); /* Separator */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Subtle shadow for the header */
        }
        #faq-container-wrapper summary:hover {
            background-color: #FFC000; /* Slightly darker yellow on hover */
            box-shadow: 0 6px 12px rgba(0,0,0,0.15); /* Enhanced shadow on hover */
        }
        #faq-container-wrapper summary::-webkit-details-marker {
            display: none;
        }
        #faq-container-wrapper summary::after {
            content: '+';
            font-size: 2rem; /* Larger plus/minus icon */
            line-height: 1;
            transition: transform 0.2s ease-in-out;
            color: #1a202c; /* Dark icon */
            font-weight: 300;
        }
        #faq-container-wrapper details[open] summary::after {
            content: '-';
            transform: rotate(0deg);
        }

        /* FAQ Section (now internal to the outer details) Styling */
        #faq-section-content { /* Renamed from #faq-section to avoid conflict with the outer section */
            background-color: #f8fafc; /* Match body background for consistency */
            padding: 3rem 1.5rem; /* Adjusted padding within the expanded section */
            color: #1a202c;
        }
        #faq-section-content h2 { /* This heading is now removed in HTML, but keeping style in case needed */
            display: none; /* Hide the inner H2 as it's replaced by the summary */
        }


        .faq-item {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 1rem; /* More rounded corners */
            margin-bottom: 1.5rem; /* Increased space between FAQ items */
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); /* More visible shadow */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s;
        }
        .faq-item:hover {
            transform: translateY(-3px); /* Subtle lift on hover */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
        }

        .faq-item summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 2rem; /* More padding for summary */
            font-weight: 600;
            cursor: pointer;
            list-style: none;
            background-color: #fefefe; /* Very light background for summary */
            transition: background-color 0.2s ease-in-out;
            color: #2d3748; /* Slightly softer dark text for question */
            font-size: 1.1rem; /* Slightly larger font size for questions */
        }

        .faq-item summary:hover {
            background-color: #f0f4f8; /* Softer light gray on hover */
        }

        .faq-item summary::-webkit-details-marker {
            display: none;
        }

        .faq-item summary::after {
            content: '+';
            font-size: 1.8rem; /* Larger icon */
            line-height: 1;
            transition: transform 0.2s ease-in-out;
            color: #718096; /* Medium gray color for icon */
            font-weight: 300; /* Thinner plus/minus */
        }

        .faq-item[open] summary::after {
            content: '-';
            transform: rotate(0deg);
        }

        .faq-item-content {
            padding: 1.5rem 2rem 2rem; /* More generous padding */
            color: #4a5568; /* Standard gray for answer text */
            font-size: 1rem; /* Base font size for answers */
            line-height: 1.7; /* Increased line-height for better readability */
            border-top: 1px solid #edf2f7; /* Lighter separator line */
            background-color: #ffffff; /* White background for content */
        }

        /* Mobile adjustments for general layout */
        @media (max-width: 767px) {
            .hero-content-wrapper {
                padding-left: 1.5rem;
                padding-right: 1.5rem;
            }
            .card {
                padding: 2rem 1.5rem; /* Adjusted card padding for smaller phones */
            }
            #faq-container-wrapper { /* Ensure outer wrapper padding */
                padding-left: 1rem; /* Reduced outer FAQ padding */
                padding-right: 1rem; /* Reduced outer FAQ padding */
            }
            #faq-container-wrapper summary { /* Outer summary padding for mobile */
                padding: 1.25rem 1.5rem;
                font-size: 1.5rem;
            }
            #faq-section-content {
                padding: 2rem 1rem; /* Adjusted content padding inside FAQ */
            }
            .faq-item summary, .faq-item-content {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            #main-app-section > .container {
                padding: 0 1.5rem; /* Ensure consistent padding on main app sections */
            }
            #dashboard-content-area {
                padding: 1.5rem; /* Adjusted dashboard content area padding for mobile */
            }
            #order-placement-section,
            #my-orders-section,
            #account-settings-section {
                padding: 1.5rem; /* Adjusted inner section padding for mobile */
            }
        }
    </style>
</head>
<body>
    <nav class="main-navbar py-4 px-4 sm:px-6 lg:px-8">
        <div class="container mx-auto flex items-center justify-between relative">
            <div class="flex items-center">
                <a href="https://i.imgur.com/Sede46z.jpeg" target="_blank" class="flex items-center">
                    <img src="https://i.imgur.com/Sede46z.jpeg" alt="BD NETWORK SOLUTIONS Logo" class="h-12 w-auto mr-3 rounded-full">
                </a>
                <div class="flex flex-col items-start ml-3">
                    <span class="logo-text">BD NETWORK SOLUTIONS</span>
                    <span class="slogan-text">YOUR LINK TO THE DIGITAL WORLD</span>
                </div>
            </div>
            <button id="mobile-menu-button" aria-label="Open menu">
                <svg viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7">
                    <path fill-rule="evenodd" d="M3 6.75A.75.75 0 013.75 6h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 6.75zM3 12a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 12zm0 5.25a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75z" clip-rule="evenodd" />
                </svg>
            </button>
            <!-- Mobile menu now inside this container -->
            <div id="mobile-menu" class="hidden">
                <a href="#" id="mobile-agent-link">Become an Agent</a>
                <a href="https://wa.me/233531323296" target="_blank" id="mobile-contact-link">Contact Support</a>
                <a href="https://chat.whatsapp.com/JZhLLboZmW9FjxcimGtZuX" target="_blank" id="mobile-community-link">Join Our Community</a>
            </div>
        </div>
    </nav>

    <!-- Removed #contact-name-container as requested -->
    <div id="agent-message-container">
        <span>Please reach out to <a href="mailto:bdnetworksolutions01@gmail.com" class="font-bold underline text-blue-800 hover:text-blue-600">bdnetworksolutions01@gmail.com</a> via Gmail.</span>
    </div>

    <div id="pre-login-section">
        <div class="hero-section">
            <div class="hero-overlay"></div>
            <div class="hero-content-wrapper container mx-auto flex flex-col md:flex-row items-center md:items-start justify-center gap-8 px-4 sm:px-6 lg:px-8">
                <div class="hero-text-content md:w-1/2 lg:w-2/5 text-center md:text-left mb-8 md:mb-0">
                    <h1 class="text-white">Enjoy Affordable and Non-Expiry Data Bundle Offers</h1>
                    <p class="text-white">Experience seamless connectivity with our flexible data plans.</p>
                </div>
                <div class="max-w-md w-full md:w-1/2 lg:w-2/5 card" id="auth-section">
                    <div>
                        <h2 class="mt-6 text-center text-3xl font-extrabold" id="auth-title">
                            Sign In
                        </h2>
                    </div>

                    <!-- Removed social sign-in buttons -->
                    <!-- <div class="mt-6">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <button type="button" id="google-signin-button"
                                        class="w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    <i class="fab fa-google mr-2"></i>
                                    Google
                                </button>
                            </div>
                            <div>
                                <button type="button" id="apple-signin-button"
                                        class="w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    <i class="fab fa-apple mr-2"></i>
                                    Apple
                                </button>
                            </div>
                        </div>
                    </div> -->

                    <div class="relative my-6">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-gray-300"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-2 bg-white text-gray-500">Sign in with Email</span>
                        </div>
                    </div>

                    <form class="space-y-4 md:space-y-6" id="signInForm">
                        <div>
                            <label for="signin-email" class="sr-only">Email Address</label>
                            <input id="signin-email" name="email" type="email" autocomplete="email" required
                                   class="appearance-none relative block w-full input-field"
                                   placeholder="Email">
                        </div>
                        <div class="password-input-container">
                            <label for="signin-password" class="sr-only">Password</label>
                            <input id="signin-password" name="password" type="password" autocomplete="current-password" required
                                   class="appearance-none relative block w-full input-field"
                                   placeholder="Password">
                            <button type="button" id="toggle-signin-password" class="password-toggle" aria-label="Show password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>

                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input id="remember-me" name="remember-me" type="checkbox"
                                       class="h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300 rounded">
                                <label for="remember-me" class="ml-2 block text-sm">
                                    Remember me
                                </label>
                            </div>
                            <div class="text-sm">
                                <a href="#" id="forgot-password-link" class="font-medium text-yellow-600 hover:text-yellow-500">
                                    Forgot Password?
                                </a>
                            </div>
                        </div>

                        <div class="mt-6">
                            <button type="submit"
                                    class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md submit-button">
                                LOGIN
                            </button>
                        </div>
                    </form>

                    <p class="mt-4 text-center text-sm" id="auth-subtitle">
                        Not a Member yet? <span class="auth-toggle-link text-blue-600 hover:text-blue-800 cursor-pointer" data-target="signup">Sign Up</span>
                    </p>

                    <form class="space-y-4 md:space-y-6 hidden" id="signUpForm">
                        <div>
                            <label for="signup-name" class="sr-only">Your Name</label>
                            <input id="signup-name" name="name" type="text" required
                                   class="appearance-none relative block w-full input-field"
                                   placeholder="Your Name">
                        </div>
                        <div>
                            <label for="signup-email" class="sr-only">Email Address</label>
                            <input id="signup-email" name="email" type="email" autocomplete="email" required
                                   class="appearance-none relative block w-full input-field"
                                   placeholder="Email Address">
                        </div>
                        <div class="password-input-container">
                            <label for="signup-password" class="sr-only">Password</label>
                            <input id="signup-password" name="password" type="password" autocomplete="new-password" required
                                   class="appearance-none relative block w-full input-field"
                                   placeholder="Password">
                            <button type="button" id="toggle-signup-password" class="password-toggle" aria-label="Show password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="password-input-container">
                            <label for="signup-confirm-password" class="sr-only">Confirm Password</label>
                            <input id="signup-confirm-password" name="confirmPassword" type="password" autocomplete="new-password" required
                                   class="appearance-none relative block w-full input-field"
                                   placeholder="Confirm Password">
                            <button type="button" id="toggle-signup-confirm-password" class="password-toggle" aria-label="Show password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="mt-6">
                            <button type="submit"
                                    class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md submit-button">
                                Sign Up
                            </button>
                        </div>
                    </form>

                    <form class="space-y-4 md:space-y-6 hidden" id="forgotPasswordForm">
                        <div>
                            <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
                                Reset Password
                            </h2>
                            <p class="mt-2 text-center text-sm text-gray-600">
                                Enter your email address to receive a password reset link.
                            </p>
                        </div>
                        <div>
                            <label for="reset-email" class="sr-only">Email Address</label>
                            <input id="reset-email" name="email" type="email" autocomplete="email" required
                                   class="appearance-none relative block w-full input-field"
                                   placeholder="Email Address">
                        </div>
                        <div class="mt-6">
                            <button type="submit"
                                    class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md submit-button">
                                Send Reset Link
                            </button>
                        </div>
                        <div class="text-center text-sm mt-4">
                            <a href="#" id="back-to-signin-link" class="font-medium text-yellow-600 hover:text-yellow-500">
                                Back to Sign In
                            </a>
                        </div>
                    </form>

                    <div id="message-box" class="hidden message-box info"></div>
                </div>
            </div>
        </div>

        <!-- Outer Details for the entire FAQ section -->
        <div id="faq-container-wrapper">
            <details>
                <summary>Frequently Asked Questions</summary>
                <!-- FAQ Section content -->
                <div id="faq-section-content">
                    <div class="p-6 md:p-8">
                        <div class="space-y-4">
                            <details class="faq-item">
                                <summary>Where do I find my order after placing one?</summary>
                                <div class="faq-item-content">
                                    <p>Simply click on the "My Orders" tab in your account, then click "Show My Orders" to view all your past and current orders.</p>
                                </div>
                            </details>

                            <details class="faq-item">
                                <summary>Can I place an order if I'm not signed in?</summary>
                                <div class="faq-item-content">
                                    <p>No, you can only place an order when you are logged into your account.</p>
                                </div>
                            </details>

                            <details class="faq-item">
                                <summary>Can I buy for friends and family?</summary>
                                <div class="faq-item-content">
                                    <p>Yes! There's an option to "Add Another Order" which allows you to place multiple orders at once for different numbers.</p>
                                </div>
                            </details>

                            <details class="faq-item">
                                <summary>Can I share the website link with my friends and family?</summary>
                                <div class="faq-item-content">
                                    <p>Yes, please do! They can create an account and place orders themselves too.</p>
                                </div>
                            </details>

                            <details class="faq-item">
                                <summary>What times can I place orders?</summary>
                                <div class="faq-item-content">
                                    <p>You can place orders at any time. Our active working hours are 8 AM to 8 PM, Monday to Saturday. If you place an order outside these hours, your data will still be delivered in due time. Thank you!</p>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>
            </details>
        </div>
    </div>

    <div id="main-app-section" class="flex flex-col flex-grow items-center w-full px-4 sm:px-6 lg:px-8 py-8" style="display: none;">
        <div class="container mx-auto dashboard-content-wrapper">
            <div class="user-info-bar mb-8">
                <span id="user-display"></span>
                <button id="signOutButton">Sign Out</button>
            </div>

            <div id="dashboard-content-area">
                <div class="dashboard-nav-buttons flex flex-wrap justify-center gap-4 mb-8">
                    <button id="order-placement-btn" class="active">
                        <i class="fas fa-shopping-cart"></i> Order Data
                    </button>
                    <button id="my-orders-btn">
                        <i class="fas fa-history"></i> My Orders
                    </button>
                    <button id="account-settings-btn">
                        <i class="fas fa-user-cog"></i> Account
                    </button>
                </div>

                <section id="order-placement-section">
                    <div id="order-details-step" class="p-6 md:p-8">
                        <h3 class="mt-6 text-center text-2xl font-extrabold text-yellow-400 mb-6">
                            MTNUP2U DATA BUNDLE
                        </h3>
                        <p class="mt-2 text-center text-sm text-gray-600">
                            Fill in your details to place your order.
                        </p>
                        <form class="mt-8 space-y-6" id="orderForm">
                            <!-- Container for multiple order items -->
                            <div id="order-items-container">
                                <!-- Initial order item will be added by JavaScript -->
                            </div>

                            <button type="button" id="add-another-order-btn" class="submit-button w-full py-2 px-4 rounded-md text-sm font-medium shadow-md transition-all duration-200 ease-in-out hover:shadow-lg mt-4">
                                Add Another Order
                            </button>

                            <div class="mt-6 text-right">
                                <p class="text-lg font-bold">Total Amount: <span id="total-order-amount">GHS 0.00</span></p>
                            </div>

                            <div>
                                <button type="submit"
                                        class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md submit-button">
                                    Proceed to Payment
                                </button>
                            </div>
                        </form>
                    </div>

                    </section>

                <section id="my-orders-section" class="hidden">
                    <div class="p-6 md:p-8">
                        <h2 class="text-2xl font-bold mb-6 text-center">My Data Orders</h2>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="stat-card">
                                <div>
                                    <p class="stat-label">Total Orders</p>
                                    <p class="stat-value" id="total-orders">0</p>
                                </div>
                                <i class="fas fa-list-alt text-4xl text-blue-500"></i>
                            </div>
                            <div class="stat-card">
                                <div>
                                    <p class="stat-label">Submitted</p>
                                    <p class="stat-value text-orange-500" id="pending-orders">0</p>
                                </div>
                                <i class="fas fa-hourglass-half text-4xl text-orange-500"></i>
                            </div>
                        </div>

                        <button id="toggle-orders-display" class="submit-button mt-4 w-full py-2 px-4 rounded-md text-sm font-medium shadow-md transition-all duration-200 ease-in-out hover:shadow-lg">
                            Show My Orders
                        </button>

                        <div id="orders-list" class="space-y-4 mt-6 hidden"> <p class="text-gray-600 text-center" id="no-orders-message">No orders placed yet.</p>
                        </div>
                    </div>
                </section>

                <section id="account-settings-section" class="hidden">
                    <div class="p-6 md:p-8">
                        <h2 class="text-2xl font-bold mb-6 text-center">Account Settings</h2>

                        <form id="profile-edit-form" class="space-y-6 mb-8">
                            <h3 class="text-xl font-semibold mb-4">Edit Profile Information</h3>
                            <div>
                                <label for="profile-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name:</label>
                                <input type="text" id="profile-name" name="name" class="input-field block w-full">
                            </div>
                            <div>
                                <label for="profile-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address:</label>
                                <input type="email" id="profile-email" name="email" class="input-field block w-full">
                            </div>
                            <div>
                                <label for="profile-phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number:</label>
                                <input type="tel" id="profile-phone" name="phone" class="input-field block w-full">
                            </div>
                            <button type="submit" class="submit-button w-full py-2 px-4 rounded-md text-sm font-medium shadow-md transition-all duration-200 ease-in-out hover:shadow-lg">
                                Update Profile
                            </button>
                        </form>

                        <form id="password-change-form" class="space-y-6">
                            <h3 class="text-xl font-semibold mb-4">Change Password</h3>
                            <div>
                                <label for="current-password" class="block text-sm font-medium text-gray-700 mb-1">Current Password:</label>
                                <input type="password" id="current-password" name="currentPassword" class="input-field block w-full" required>
                            </div>
                            <div>
                                <label for="new-password" class="block text-sm font-medium text-gray-700 mb-1">New Password:</label>
                                <input type="password" id="new-password" name="newPassword" class="input-field block w-full" required>
                            </div>
                            <div>
                                <label for="confirm-new-password" class="block text-sm font-medium text-gray-700 mb-1">Confirm New Password:</label>
                                <input type="password" id="confirm-new-password" name="confirmNewPassword" class="input-field block w-full" required>
                            </div>
                            <button type="submit" class="submit-button w-full py-2 px-4 rounded-md text-sm font-medium shadow-md transition-all duration-200 ease-in-out hover:shadow-lg">
                                Change Password
                            </button>
                        </form>
                        <div id="account-message-box" class="message-box info hidden mt-4"></div>
                    </div>
                </section>
            </div> </div>
    </div>

    <!-- Template for a single order item to be cloned by JavaScript -->
    <template id="order-item-template">
        <div class="single-order-item space-y-4">
            <button type="button" class="remove-order-item-btn" aria-label="Remove order item">X</button>
            <div>
                <label for="contact-number" class="sr-only">Contact Number</label>
                <input id="contact-number" name="contactNumber" type="tel" required
                       class="appearance-none relative block w-full input-field"
                       placeholder="Contact Number (e.g., 0531323296)">
            </div>
            <div>
                <label for="data-size" class="sr-only">Data Size</label>
                <select id="data-size" name="dataSize" required
                        class="appearance-none relative block w-full input-field">
                    <option value="" disabled selected>Select Data Size</option>
                    <!-- Options will be dynamically populated here with prices -->
                </select>
            </div>
            <div>
                <label for="amount" class="sr-only">Amount</label>
                <input id="amount" name="amount" type="text" readonly
                       class="appearance-none relative block w-full input-field"
                       placeholder="Amount (Ghc)" value="">
            </div>
        </div>
    </template>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

    <script>
        // Your Firebase project configuration
        const firebaseConfig = {
            apiKey: "AIzaSyByXcxgxh86rOXuX-j1xmeAl9NVyPa85NA",
            authDomain: "bd-network-5b70e.firebaseapp.com",
            projectId: "bd-network-5b70e",
            storageBucket: "bd-network-5b70e.firebasestorage.app",
            messagingSenderId: "284926879983",
            appId: "1:284926879983:web:9aa2555471d123d0cc931a"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        // const db = firebase.firestore(); // Uncomment if using Firestore

        document.addEventListener('DOMContentLoaded', () => {
            // New prices provided by the user
            const rawPrices = {
                "1GB": "6Ghc", "2GB": "11.50Ghc", "3GB": "16.50Ghc", "4GB": "22Ghc",
                "5GB": "26.50Ghc", "6GB": "31.50Ghc", "8GB": "41.50Ghc", "10GB": "49Ghc",
                "15GB": "72Ghc", "20GB": "95Ghc", "30GB": "143Ghc", "50GB": "220Ghc",
                "100GB": "425Ghc"
            };

            // Convert rawPrices to the existing dataBundles format for all networks
            const newBundles = Object.keys(rawPrices).map(size => {
                const priceString = rawPrices[size];
                const price = parseFloat(priceString.replace('Ghc', ''));
                return { "size": size, "price": price, "validity": "30 days" };
            });

            var dataBundles = {
                "MTN": newBundles,
                "Vodafone": newBundles,
                "AirtelTigo": newBundles
            };
            const bundlePricesLookup = {};
            newBundles.forEach(bundle => {
                bundlePricesLookup[bundle.size] = bundle.price;
            });


            // Data storage for order and user
            let collectedOrderData = {};
            let currentUserUid = null;
            let registeredUserName = '';
            let registeredUserEmail = '';
            let registeredUserPhone = '';
            // simulatedUserPassword is no longer needed with real Firebase Auth
            let currentOrders = [];


            // DOM Elements
            const preLoginSection = document.getElementById('pre-login-section');
            const mainAppSection = document.getElementById('main-app-section');
            const signOutButton = document.getElementById('signOutButton');
            const authSection = document.getElementById('auth-section');
            const signInForm = document.getElementById('signInForm');
            const signUpForm = document.getElementById('signUpForm');
            const forgotPasswordForm = document.getElementById('forgotPasswordForm');
            const authTitle = document.getElementById('auth-title');
            const authSubtitle = document.getElementById('auth-subtitle');
            const messageBox = document.getElementById('message-box');
            
            const orderDetailsStep = document.getElementById('order-details-step');
            const orderForm = document.getElementById('orderForm');
            // Removed direct references to contactNumberInput, dataSizeSelect, amountInput
            // as they will now be dynamic within order-items-container
            const orderItemsContainer = document.getElementById('order-items-container');
            const addAnotherOrderBtn = document.getElementById('add-another-order-btn');
            const totalOrderAmountSpan = document.getElementById('total-order-amount');


            const orderPlacementBtn = document.getElementById('order-placement-btn');
            const myOrdersBtn = document.getElementById('my-orders-btn');
            const accountSettingsBtn = document.getElementById('account-settings-btn');
            const orderPlacementSection = document.getElementById('order-placement-section');
            const myOrdersSection = document.getElementById('my-orders-section');
            const accountSettingsSection = document.getElementById('account-settings-section');

            const userDisplay = document.getElementById('user-display');
            const totalOrdersSpan = document.getElementById('total-orders');
            const submittedOrdersSpan = document.getElementById('pending-orders');
            const ordersList = document.getElementById('orders-list');
            const noOrdersMessage = document.getElementById('no-orders-message');
            const toggleOrdersDisplayButton = document.getElementById('toggle-orders-display');

            const profileEditForm = document.getElementById('profile-edit-form');
            const profileNameInput = document.getElementById('profile-name');
            const profileEmailInput = document.getElementById('profile-email');
            const profilePhoneInput = document.getElementById('profile-phone');
            const passwordChangeForm = document.getElementById('password-change-form');
            const currentPasswordInput = document.getElementById('current-password');
            const newPasswordInput = document.getElementById('new-password');
            const confirmNewPasswordInput = document.getElementById('confirm-new-password');
            const accountMessageBox = document.getElementById('account-message-box');


            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileAgentLink = document.getElementById('mobile-agent-link');
            const mobileContactLink = document.getElementById('mobile-contact-link');
            // REMOVED contactNameContainer from DOM Elements as requested by the user
            const agentMessageContainer = document.getElementById('agent-message-container');
            // ADDED mobileCommunityLink as requested by the user
            const mobileCommunityLink = document.getElementById('mobile-community-link');


            const forgotPasswordLink = document.getElementById('forgot-password-link');
            const resetEmailInput = document.getElementById('reset-email');
            const backToSignInLink = document.getElementById('back-to-signin-link');

            // Removed social sign-in buttons from JS references
            // const googleSignInButton = document.getElementById('google-signin-button');
            // const appleSignInButton = document.getElementById('apple-signin-button');

            // Template for cloning order items
            const orderItemTemplate = document.getElementById('order-item-template');

            let currentView = 'order-placement';
            let orderItemCounter = 0; // To ensure unique IDs for dynamically added fields


            // Helper functions for showing/hiding sections
            function showMainApp() {
                preLoginSection.style.display = 'none';
                mainAppSection.style.display = 'flex';
                switchDashboardView('order-placement');
                updateOrderStats();
                messageBox.classList.add('hidden');
            }

            function showAuthForms() {
                mainAppSection.style.display = 'none';
                // Set preLoginSection to flex to enable centering of auth card and FAQ
                preLoginSection.style.display = 'flex';
                preLoginSection.style.flexDirection = 'column';
                preLoginSection.style.alignItems = 'center';
                preLoginSection.style.justifyContent = 'center';

                userDisplay.textContent = '';
                
                currentUserUid = null;
                currentOrders = [];
                registeredUserName = '';
                registeredUserEmail = '';
                registeredUserPhone = '';
                // simulatedUserPassword is not used for real auth
                signInForm.classList.remove('hidden');
                signUpForm.classList.add('hidden');
                forgotPasswordForm.classList.add('hidden');
                authTitle.textContent = 'Sign In'; // Updated title
                authSubtitle.innerHTML = 'Not a Member yet? <span class="auth-toggle-link text-blue-600 hover:text-blue-800 cursor-pointer" data-target="signup">Sign Up</span>'; // Updated subtitle
            }


            // --- Firebase Auth State Change Listener ---
            auth.onAuthStateChanged((user) => {
                if (user) {
                    console.log('User state changed: Signed IN.', user.uid, user.email, user.displayName);
                    currentUserUid = user.uid;
                    registeredUserName = user.displayName || '';
                    registeredUserEmail = user.email || '';
                    // If you store phone number in Firebase, retrieve it here
                    // registeredUserPhone = user.phoneNumber || '';

                    // Load orders for the authenticated user
                    currentOrders = JSON.parse(localStorage.getItem(`userOrders_${currentUserUid}`)) || [];

                    userDisplay.textContent = `Welcome, ${user.displayName || user.email}`;
                    showMainApp();
                    displayMessage('You are signed in!', 'success');
                } else {
                    console.log('User state changed: Signed OUT.');
                    showAuthForms();
                    displayMessage('Please sign in or sign up to place an order.', 'info');
                }
            });


            // --- Sign-in Form Submission ---
            signInForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                console.log('Sign In form submitted.');
                const email = document.getElementById('signin-email').value;
                const password = document.getElementById('signin-password').value;
                
                const rememberMe = document.getElementById('remember-me').checked;
                const persistence = rememberMe ? firebase.auth.Auth.Persistence.LOCAL : firebase.auth.Auth.Persistence.SESSION;

                displayMessage('Signing in...', 'info');
                
                try {
                    await auth.setPersistence(persistence);
                    await auth.signInWithEmailAndPassword(email, password);
                    // onAuthStateChanged listener will handle showing the main app and loading orders
                    messageBox.classList.add('hidden');
                } catch (error) {
                    console.error("Sign In Error:", error);
                    displayMessage(`Sign In Failed: ${error.message}`, 'error');
                }
            });
            
            // --- Sign-up Form Submission ---
            signUpForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                registeredUserName = document.getElementById('signup-name').value;
                registeredUserEmail = document.getElementById('signup-email').value;
                registeredUserPhone = ''; // Phone number removed from signup form, clear it
                const signupPassword = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-confirm-password').value;

                if (signupPassword !== confirmPassword) {
                    displayMessage('Passwords do not match.', 'error');
                    return;
                }

                displayMessage('Signing up...', 'info');

                try {
                    const userCredential = await auth.createUserWithEmailAndPassword(registeredUserEmail, signupPassword);
                    await userCredential.user.updateProfile({ displayName: registeredUserName });
                    
                    displayMessage('Sign up successful! Please sign in using your new account.', 'success');
                    // Switch to sign-in form after successful signup
                    signInForm.classList.remove('hidden');
                    signUpForm.classList.add('hidden');
                    forgotPasswordForm.classList.add('hidden');
                    authTitle.textContent = 'Sign In'; // Keep consistent title
                    authSubtitle.innerHTML = 'Not a Member yet? <span class="auth-toggle-link text-blue-600 hover:text-blue-800 cursor-pointer" data-target="signup">Sign Up</span>'; // Changed text
                } catch (error) {
                    console.error("Sign Up Error:", error);
                    displayMessage(`Sign Up Failed: ${error.message}`, 'error');
                }
            });

            // --- Logout Functionality ---
            signOutButton.addEventListener('click', async () => {
                try {
                    await auth.signOut();
                    console.log('Firebase Sign Out successful.');
                    // onAuthStateChanged listener will handle showing auth forms
                } catch (error) {
                    console.error('Firebase Sign Out Error:', error);
                    displayMessage(`Sign Out Failed: ${error.message}`, 'error');
                }
            });

            // --- Auth Toggle Functionality (Using Event Delegation) ---
            authSection.addEventListener('click', (event) => {
                // Check if the clicked element or its parent is an auth-toggle-link
                const toggleLink = event.target.closest('.auth-toggle-link');
                if (toggleLink) {
                    const target = toggleLink.dataset.target;
                    if (target === 'signup') {
                        signInForm.classList.add('hidden');
                        signUpForm.classList.remove('hidden');
                        forgotPasswordForm.classList.add('hidden');
                        authTitle.textContent = 'Sign Up'; // Changed to "Sign Up" for clarity
                        authSubtitle.innerHTML = 'Already a Member? <span class="auth-toggle-link text-blue-600 hover:text-blue-800 cursor-pointer" data-target="signin">Sign In</span>'; // Changed text
                    } else if (target === 'signin') {
                        signInForm.classList.remove('hidden');
                        signUpForm.classList.add('hidden');
                        forgotPasswordForm.classList.add('hidden');
                        authTitle.textContent = 'Sign In';
                        authSubtitle.innerHTML = 'Not a Member yet? <span class="auth-toggle-link text-blue-600 hover:text-blue-800 cursor-pointer" data-target="signup">Sign Up</span>';
                    }
                    messageBox.classList.add('hidden');
                }
            });

            // New: Forgot Password Link Click
            forgotPasswordLink.addEventListener('click', (event) => {
                event.preventDefault();
                signInForm.classList.add('hidden');
                signUpForm.classList.add('hidden');
                forgotPasswordForm.classList.remove('hidden');
                authTitle.textContent = 'Reset Your Password';
                authSubtitle.innerHTML = 'Enter your email to receive a reset link.';
                messageBox.classList.add('hidden');
            });

            // New: Back to Sign In Link Click
            backToSignInLink.addEventListener('click', (event) => {
                event.preventDefault();
                signInForm.classList.remove('hidden');
                signUpForm.classList.add('hidden');
                forgotPasswordForm.classList.add('hidden');
                authTitle.textContent = 'Sign In';
                authSubtitle.innerHTML = 'Not a Member yet? <span class="auth-toggle-link text-blue-600 hover:text-blue-800 cursor-pointer" data-target="signup">Sign Up</span>';
                messageBox.classList.add('hidden');
            });

            // New: Forgot Password Form Submission (Real Firebase)
            forgotPasswordForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                const resetEmail = resetEmailInput.value.trim();
                if (resetEmail) {
                    displayMessage('Sending reset link...', 'info');
                    try {
                        await auth.sendPasswordResetEmail(resetEmail);
                        displayMessage(`If an account with ${resetEmail} exists, a password reset link has been sent. Please check your inbox.`, 'success');
                        resetEmailInput.value = '';
                        setTimeout(() => {
                            signInForm.classList.remove('hidden');
                            signUpForm.classList.add('hidden');
                            forgotPasswordForm.classList.add('hidden');
                            authTitle.textContent = 'Sign In';
                            authSubtitle.innerHTML = 'Not a Member yet? <span class="auth-toggle-link text-blue-600 hover:text-blue-800 cursor-pointer" data-target="signup">Sign Up</span>';
                            messageBox.classList.add('hidden');
                        }, 5000); // Redirect after 5 seconds
                    }
                    catch (error) {
                        console.error("Password Reset Error:", error);
                        displayMessage(`Failed to send reset link: ${error.message}`, 'error');
                    }
                } else {
                    displayMessage('Please enter your email address.', 'error');
                }
            });


            function displayMessage(message, type) {
                messageBox.textContent = message;
                messageBox.className = `message-box ${type}`;
                messageBox.classList.remove('hidden');
            }
            
            function displayAccountMessage(message, type) {
                accountMessageBox.textContent = message;
                accountMessageBox.className = `message-box ${type}`;
                accountMessageBox.classList.remove('hidden');
            }


            // --- Dynamic Order Form Logic ---
            function addOrderItem() {
                const clone = orderItemTemplate.content.cloneNode(true);
                const contactNumberInput = clone.querySelector('[name="contactNumber"]');
                const dataSizeSelect = clone.querySelector('[name="dataSize"]');
                const amountInput = clone.querySelector('[name="amount"]');
                const removeButton = clone.querySelector('.remove-order-item-btn');

                // Assign unique IDs to cloned elements and update labels
                const currentCount = orderItemsContainer.children.length;
                contactNumberInput.id = `contact-number-${currentCount}`;
                contactNumberInput.previousElementSibling.setAttribute('for', `contact-number-${currentCount}`);
                dataSizeSelect.id = `data-size-${currentCount}`;
                dataSizeSelect.previousElementSibling.setAttribute('for', `data-size-${currentCount}`);
                amountInput.id = `amount-${currentCount}`;
                amountInput.previousElementSibling.setAttribute('for', `amount-${currentCount}`);

                // Populate data size options with prices
                dataSizeSelect.innerHTML = '<option value="" disabled selected>Select Data Size</option>';
                newBundles.forEach(bundle => {
                    const option = document.createElement('option');
                    option.value = bundle.size;
                    option.textContent = `${bundle.size} - GHS ${bundle.price.toFixed(2)}`;
                    dataSizeSelect.appendChild(option);
                });

                // Attach event listener for data size change on this new item
                dataSizeSelect.addEventListener('change', () => {
                    const selectedSize = dataSizeSelect.value;
                    if (selectedSize && bundlePricesLookup[selectedSize]) {
                        amountInput.value = bundlePricesLookup[selectedSize].toFixed(2);
                    } else {
                        amountInput.value = '';
                    }
                    updateTotalAmount(); // Recalculate total when an item's amount changes
                });

                // Attach event listener for remove button
                removeButton.addEventListener('click', (event) => {
                    event.target.closest('.single-order-item').remove();
                    updateTotalAmount(); // Recalculate total when an item is removed
                });

                orderItemsContainer.appendChild(clone);
                updateTotalAmount(); // Update total after adding a new item
            }

            function updateTotalAmount() {
                let total = 0;
                // Select all amount inputs within the order-items-container
                const amountInputs = orderItemsContainer.querySelectorAll('[name="amount"]');
                amountInputs.forEach(input => {
                    const value = parseFloat(input.value);
                    if (!isNaN(value)) {
                        total += value;
                    }
                });
                totalOrderAmountSpan.textContent = `GHS ${total.toFixed(2)}`;
            }

            // Add initial order item when the page loads
            addOrderItem();

            // Event listener for "Add Another Order" button
            addAnotherOrderBtn.addEventListener('click', addOrderItem);


            // --- Order Form Submission (Now initiates Paystack payment for multiple orders) ---
            orderForm.addEventListener('submit', async (event) => {
                event.preventDefault();

                if (!currentUserUid) {
                    displayMessage('You must be signed in to place an order.', 'error');
                    showAuthForms();
                    return;
                }

                const allOrderItems = orderItemsContainer.querySelectorAll('.single-order-item');
                const ordersToProcess = [];
                let totalPaymentAmount = 0;

                // Collect data for each order item
                allOrderItems.forEach((item, index) => {
                    const contactNumber = item.querySelector('[name="contactNumber"]').value.trim();
                    const dataSize = item.querySelector('[name="dataSize"]').value;
                    const amount = parseFloat(item.querySelector('[name="amount"]').value);

                    if (!contactNumber || !dataSize || isNaN(amount) || amount <= 0) {
                        displayMessage(`Please fill all details for order item ${index + 1}.`, 'error');
                        ordersToProcess.length = 0; // Clear array to prevent partial submission
                        return; // Stop processing further
                    }

                    ordersToProcess.push({
                        network: 'MTN', // Assuming MTN for all for now
                        bundleSize: dataSize,
                        bundlePrice: amount,
                        recipientPhone: contactNumber,
                        customerDisplayName: registeredUserName || 'N/A',
                        customerEmail: registeredUserEmail || 'guest@example.com',
                        timestamp: new Date().toLocaleString(),
                        userId: currentUserUid,
                        status: 'Initiated' // Initial status for Apps Script
                    });
                    totalPaymentAmount += amount;
                });

                if (ordersToProcess.length === 0) {
                    displayMessage('No valid orders to process.', 'error');
                    return;
                }

                displayMessage('Preparing payment. Please wait...', 'info');
                console.log('--- Paystack Setup Details ---');
                console.log('Customer Email:', registeredUserEmail);
                console.log('Total Payment Amount (GHS):', totalPaymentAmount);
                console.log('Total Payment Amount (kobo/pesewas):', totalPaymentAmount * 100);
                console.log('Orders to Process:', ordersToProcess);
                console.log('------------------------------');


                // --- Paystack Checkout Integration for combined amount ---
                const handler = PaystackPop.setup({
                    key: 'pk_live_8e753f43f8defed950965395fc04f5dc7ab1035b', // Your actual public key
                    email: registeredUserEmail, // Pre-fill email
                    amount: totalPaymentAmount * 100, // Amount in kobo/pesewas (multiply by 100)
                    currency: 'GHS', // Ghana Cedis
                    ref: 'ORD_' + Date.now(), // Unique reference for the entire transaction
                    firstname: registeredUserName.split(' ')[0] || '', // Pre-fill first name
                    lastname: registeredUserName.split(' ').slice(1).join(' ') || '',   // Pre-fill last name
                    metadata: {
                        custom_fields: [
                            {
                                display_name: "Customer ID",
                                variable_name: "customer_id",
                                value: currentUserUid
                            },
                            {
                                display_name: "Orders Details",
                                variable_name: "orders_details",
                                value: JSON.stringify(ordersToProcess) // Store all individual order details as a JSON string
                            }
                        ]
                    },
                    callback: function(response){ // Payment successful callback - Now a regular function
                        (async () => { // Immediately Invoked Async Function Expression (IIAFE)
                            const paymentReference = response.reference;
                            console.log('Paystack Payment Successful! Reference:', paymentReference);
                            displayMessage('Payment successful! Logging order details...', 'success');

                            // --- Google Apps Script Integration (MOVED HERE) ---
                            const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwKwu8XC1awByOIwiTXGGY7iMr1J_vNSrZ1tUv7tPY-Edlzvrs5H1SWyHKIjz86leYi/exec'; // Corrected Apps Script URL

                            try {
                                const scriptResponse = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                                    method: 'POST',
                                    mode: 'no-cors', // Required for simple requests to Apps Script
                                    cache: 'no-cache',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        customerName: registeredUserName,
                                        customerEmail: registeredUserEmail,
                                        customerId: currentUserUid,
                                        orders: ordersToProcess.map(order => ({
                                            ...order,
                                            status: 'Submitted', // Changed from 'Processing' to 'Submitted'
                                            paymentReference: paymentReference // Add the Paystack reference
                                        }))
                                    })
                                });

                                console.log('Order details sent to Google Apps Script. Response (if any, will be opaque due to no-cors):', scriptResponse);
                                displayMessage('Order details successfully logged to spreadsheet.', 'success');

                            } catch (error) {
                                console.error('Error sending order details to Google Apps Script:', error);
                                displayMessage('Payment successful, but failed to log order details to spreadsheet. Please contact support.', 'error');
                            }

                            // Update local storage and UI after successful payment and logging attempt
                            ordersToProcess.forEach(order => {
                                const newOrder = {
                                    id: 'ORD' + Date.now() + '-' + Math.floor(Math.random() * 1000), // More unique ID
                                    network: order.network,
                                    bundle: order.bundleSize,
                                    price: order.bundlePrice,
                                    phone: order.recipientPhone,
                                    paymentReference: paymentReference, // Use the single Paystack reference for all related orders
                                    date: new Date().toLocaleString(),
                                    status: 'Submitted' // Changed from 'Processing' to 'Submitted'
                                };
                                currentOrders.push(newOrder);
                            });
                            localStorage.setItem(`userOrders_${currentUserUid}`, JSON.stringify(currentOrders));

                            // Reset form and switch view
                            orderItemsContainer.innerHTML = ''; // Clear all existing items
                            addOrderItem(); // Add a fresh, empty order item
                            updateTotalAmount(); // Reset total amount display
                            switchDashboardView('my-orders');
                            updateOrderStats();
                        })(); // End of IIAFE
                    },
                    onClose: function(){ // Payment modal closed callback
                        displayMessage('Payment process cancelled by user.', 'info');
                    }
                });
                handler.openIframe(); // Open the Paystack payment modal
            });


            // --- Dashboard Navigation ---
            orderPlacementBtn.addEventListener('click', () => switchDashboardView('order-placement'));
            myOrdersBtn.addEventListener('click', () => switchDashboardView('my-orders'));
            accountSettingsBtn.addEventListener('click', () => switchDashboardView('account-settings'));

            function switchDashboardView(view) {
                orderPlacementSection.classList.add('hidden');
                myOrdersSection.classList.add('hidden');
                accountSettingsSection.classList.add('hidden');
                accountMessageBox.classList.add('hidden');

                orderPlacementBtn.classList.remove('active');
                myOrdersBtn.classList.remove('active');
                accountSettingsBtn.classList.remove('active');

                if (view === 'order-placement') {
                    orderPlacementSection.classList.remove('hidden');
                    orderPlacementBtn.classList.add('active');
                    // Reset order form and add initial item when switching to this view
                    orderItemsContainer.innerHTML = '';
                    addOrderItem();
                    updateTotalAmount();
                    orderDetailsStep.classList.remove('hidden');
                    messageBox.classList.add('hidden');
                } else if (view === 'my-orders') {
                    myOrdersSection.classList.remove('hidden');
                    myOrdersBtn.classList.add('active');
                    renderOrders();
                    ordersList.classList.add('hidden');
                    toggleOrdersDisplayButton.textContent = 'Show My Orders';
                } else if (view === 'account-settings') {
                    accountSettingsSection.classList.remove('hidden');
                    accountSettingsBtn.classList.add('active');
                    populateAccountSettings();
                }
                currentView = view;
            }

            // --- My Orders Section Logic ---
            function updateOrderStats() {
                totalOrdersSpan.textContent = currentOrders.filter(order => order.status !== 'Delivered').length;
                // Updated to count 'Submitted' status
                submittedOrdersSpan.textContent = currentOrders.filter(order => order.status === 'Submitted').length;
            }

            function renderOrders() {
                ordersList.innerHTML = '';
                const ordersToDisplay = currentOrders.filter(order => order.status !== 'Delivered');

                if (ordersToDisplay.length === 0) {
                    noOrdersMessage.classList.remove('hidden');
                    toggleOrdersDisplayButton.classList.add('hidden');
                } else {
                    noOrdersMessage.classList.add('hidden');
                    toggleOrdersDisplayButton.classList.remove('hidden');
                    ordersToDisplay.sort((a, b) => new Date(b.date) - new Date(a.date));
                    ordersToDisplay.forEach(order => {
                        const orderItem = document.createElement('div');
                        orderItem.classList.add('shadow-sm', 'border-gray-200');
                        let statusClass = '';
                        let displayStatus = order.status;

                        // Updated status display logic
                        if (order.status === 'Submitted') {
                            statusClass = 'status-submitted';
                            displayStatus = 'Submitted';
                        } else if (order.status === 'Processing') {
                            statusClass = 'status-processing';
                        } else if (order.status === 'Cancelled') {
                            statusClass = 'status-cancelled';
                        } else if (order.status === 'Delivered') { // Should not be in this list due to filter, but good for completeness
                            statusClass = 'status-delivered';
                        }
                        else {
                            statusClass = 'status-unknown';
                        }

                        orderItem.innerHTML = `
                            <p><strong>Order ID:</strong> ${order.id}</p>
                            <p><strong>Network:</strong> ${order.network}</p>
                            <p><strong>Bundle:</strong> ${order.bundle}</p>
                            <p><strong>Price:</strong> GHS ${order.price.toFixed(2)}</p>
                            <p><strong>Phone:</strong> ${order.phone}</p>
                            <p><strong>Reference:</strong> ${order.paymentReference || 'N/A'}</p>
                            <p><strong>Date:</strong> ${order.date}</p>
                            <p><strong>Status:</strong> <span class="${statusClass}">${displayStatus}</span></p>
                            `;
                        ordersList.appendChild(orderItem);
                    });
                }
            }

            toggleOrdersDisplayButton.addEventListener('click', () => {
                ordersList.classList.toggle('hidden');
                if (ordersList.classList.contains('hidden')) {
                    toggleOrdersDisplayButton.textContent = 'Show My Orders';
                } else {
                    toggleOrdersDisplayButton.textContent = 'Hide My Orders';
                }
            });


            // --- Simulated Admin Action: Mark Order as Delivered ---
            function markOrderAsDelivered(orderId) {
                const orderIndex = currentOrders.findIndex(order => order.id === orderId);
                if (orderIndex !== -1) {
                    currentOrders[orderIndex].status = 'Delivered';
                    displayMessage(`Order ${orderId} has been marked as Delivered!`, 'success');
                    updateOrderStats();
                    renderOrders();
                    localStorage.setItem(`userOrders_${currentUserUid}`, JSON.stringify(currentOrders));
                } else {
                    displayMessage(`Order ${orderId} not found.`, 'error');
                }
            }


            // --- Account Settings Logic ---
            function populateAccountSettings() {
                if (currentUserUid) {
                    profileNameInput.value = registeredUserName;
                    profileEmailInput.value = registeredUserEmail;
                    // In a real Firebase app, you'd fetch phone number from Firestore/Realtime DB if stored
                    profilePhoneInput.value = registeredUserPhone;
                } else {
                    profileNameInput.value = '';
                    profileEmailInput.value = '';
                    profilePhoneInput.value = '';
                }
                currentPasswordInput.value = '';
                newPasswordInput.value = '';
                confirmNewPasswordInput.value = '';
                accountMessageBox.classList.add('hidden');
            }

            profileEditForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                displayAccountMessage('Updating profile...', 'info');

                const newName = profileNameInput.value.trim();
                const newEmail = profileEmailInput.value.trim();
                const newPhone = profilePhoneInput.value.trim();

                if (!newName || !newEmail || !newPhone) {
                    displayAccountMessage('All profile fields are required.', 'error');
                    return;
                }
                
                try {
                    const user = auth.currentUser;
                    if (user) {
                        // Update display name and email in Firebase Auth
                        await user.updateProfile({ displayName: newName });
                        if (user.email !== newEmail) {
                            await user.updateEmail(newEmail);
                        }
                        // For phone number, you would typically update a Firestore/Realtime Database document
                        registeredUserName = newName;
                        registeredUserEmail = newEmail;
                        registeredUserPhone = newPhone; // Assuming this is just local state for now
                        userDisplay.textContent = `Welcome, ${registeredUserName}!`;
                        displayAccountMessage('Profile updated successfully!', 'success');
                    } else {
                        displayAccountMessage('No user is signed in to update profile.', 'error');
                    }
                } catch (error) {
                    console.error('Profile update error:', error);
                    displayAccountMessage(`Failed to update profile: ${error.message}`, 'error');
                }
            });

            passwordChangeForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                displayAccountMessage('Changing password...', 'info');

                const currentPassword = currentPasswordInput.value;
                const newPassword = newPasswordInput.value;
                const confirmNewPassword = confirmNewPasswordInput.value;

                if (!currentPassword || !newPassword || !confirmNewPassword) {
                    displayAccountMessage('All password fields are required.', 'error');
                    return;
                }

                if (newPassword.length < 6) {
                    displayAccountMessage('New password must be at least 6 characters long.', 'error');
                    return;
                }

                if (newPassword !== confirmNewPassword) {
                    displayAccountMessage('New password and confirm password do not match.', 'error');
                    return;
                }
                
                try {
                    const user = auth.currentUser;
                    if (user) {
                        // Re-authenticate user before changing password
                        const credential = firebase.auth.EmailAuthProvider.credential(user.email, currentPassword);
                        await user.reauthenticateWithCredential(credential);
                        await user.updatePassword(newPassword);
                        displayAccountMessage('Password changed successfully!', 'success');
                        currentPasswordInput.value = '';
                        newPasswordInput.value = '';
                        confirmNewPasswordInput.value = '';
                    } else {
                        displayAccountMessage('No user is signed in.', 'error');
                    }
                } catch (error) {
                    console.error('Password change error:', error);
                    displayAccountMessage(`Failed to change password: ${error.message}`, 'error');
                }
            });


            // --- Mobile Menu Toggle ---
            mobileMenuButton.addEventListener('click', (event) => {
                event.stopPropagation();
                mobileMenu.classList.toggle('open');
                // Hide agent message if menu opens
                agentMessageContainer.classList.remove('show');
            });

            // --- Mobile Menu Links Functionality ---
            mobileContactLink.addEventListener('click', (event) => {
                // The href attribute already handles the redirection, no event.preventDefault() needed
                // here unless other JS actions were intended before redirection.
                agentMessageContainer.classList.remove('show'); // Ensure only one info box is open
                mobileMenu.classList.remove('open'); // Close menu after clicking link
            });

            mobileAgentLink.addEventListener('click', (event) => {
                event.preventDefault();
                event.stopPropagation();
                agentMessageContainer.classList.toggle('show');
                mobileMenu.classList.remove('open'); // Close menu after clicking link
            });

            // New: Mobile Community Link functionality
            mobileCommunityLink.addEventListener('click', (event) => {
                // The href attribute already handles the redirection, so no extra JS needed here
                mobileMenu.classList.remove('open'); // Close menu after clicking link
            });


            // Global click handler to close menus/info boxes
            document.addEventListener('click', (event) => {
                const isClickInsideAgent = agentMessageContainer.contains(event.target) || mobileAgentLink.contains(event.target);
                const isClickInsideMobileMenuButton = mobileMenuButton.contains(event.target);
                const isClickInsideMobileMenu = mobileMenu.contains(event.target);


                if (!isClickInsideAgent && agentMessageContainer.classList.contains('show')) {
                    agentMessageContainer.classList.remove('show');
                }
                if (!isClickInsideMobileMenuButton && !isClickInsideMobileMenu && mobileMenu.classList.contains('open')) {
                    mobileMenu.classList.remove('open');
                }
            });

            // Adjust mobile menu display on window resize
            window.addEventListener('resize', () => {
                if (mobileMenu.classList.contains('open') && window.innerWidth >= 768) {
                    mobileMenu.classList.remove('open');
                }
                agentMessageContainer.classList.remove('show');
            });
            
            // --- Google Sign-in ---
            // googleSignInButton.addEventListener('click', async () => {
            //     displayMessage('Signing in with Google...', 'info');
            //     const provider = new firebase.auth.GoogleAuthProvider();
            //     try {
            //         await auth.signInWithPopup(provider);
            //         // onAuthStateChanged listener will handle showing the main app
            //         messageBox.classList.add('hidden');
            //     } catch (error) {
            //         console.error("Google Sign In Error:", error);
            //         displayMessage(`Google Sign In Failed: ${error.message}`, 'error');
            //     }\
            // });

            // --- Apple Sign-in ---
            // appleSignInButton.addEventListener('click', async () => {
            //     displayMessage('Signing in with Apple...', 'info');
            //     const provider = new firebase.auth.OAuthProvider('apple.com');
            //     // Request email and name scopes
            //     provider.addScope('email');
            //     provider.addScope('name');
            //     try {
            //         await auth.signInWithPopup(provider);
            //         // onAuthStateChanged listener will handle showing the main app
            //         messageBox.classList.add('hidden');
            //     } catch (error) {
            //         console.error("Apple Sign In Error:", error);
            //         displayMessage(`Apple Sign In Failed: ${error.message}`, 'error');
            //     }
            // });

            // --- Password Toggle Functionality ---
            function setupPasswordToggle(passwordInputId, toggleButtonId) {
                const passwordInput = document.getElementById(passwordInputId);
                const toggleButton = document.getElementById(toggleButtonId);

                if (passwordInput && toggleButton) {
                    toggleButton.addEventListener('click', () => {
                        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                        passwordInput.setAttribute('type', type);
                        // Toggle the eye icon
                        toggleButton.querySelector('i').classList.toggle('fa-eye');
                        toggleButton.querySelector('i').classList.toggle('fa-eye-slash');
                        // Update aria-label for accessibility
                        toggleButton.setAttribute('aria-label', type === 'password' ? 'Show password' : 'Hide password');
                    });
                }
            }

            // Apply password toggle to all relevant fields
            setupPasswordToggle('signin-password', 'toggle-signin-password');
            setupPasswordToggle('signup-password', 'toggle-signup-password');
            setupPasswordToggle('signup-confirm-password', 'toggle-signup-confirm-password');
        });
    </script>
</body>
</html>
